---
title:  2.1 初识声明，类型与对象
---

在 C++ 中，**声明**可以将一个标识符与一个类型或者对象联系起来。

为了理解声明的作用，这里我们也简要介绍一下类型和对象的概念。

## 类型与对象

在 C++ 中，内存的基本单位是**字节**。一个**对象**占据内存中的一块区域，也即多个连续的字节（可能是0个）。

并且，对象具有一个**类型**。对象的类型决定了对象的值的集合，以及对象上可以进行的操作。

当我们声明一个对象时，需要指定对象的类型；通过声明，我们创造了这个对象。

举例而言，在关键字中提到了 `int`，这个关键字表示的是整数类型。整数类型的对象具有整数值，并具有整数运算的行为。

假设我们已经有整数类型的对象 `a`、`b`和`c`，我们可以对`a`、`b`进行加法运算，然后把结果赋值给 `c`：
```cpp
c = a + b
```
由于 `a`、`b`和`c`都是整数类型的对象，所以这个计算符合整数加法的规则。例如，如果 `a` 和 `b` 的值分别是 `1` 和 `2`，那么 `c` 的被赋予的值将是 `3`。

而如果 `a` 或者 `b` 不是整数类型，那么这个计算的规则就不一定是整数加法了。

## 简单声明

在 C++ 中，声明的形式是：`类型 标识符;` 或者 `类型 标识符 初始化器;`。不要忘了最后的分号 `;`，这个分号表示声明的结束。

初始化器有很多形式，在这一章节中我们只介绍最简单的形式，即 `= 字面量`。

举例而言，下面的代码声明了一个整数类型的对象 `a`：

```cpp
int a;
```

上面这个声明的作用是创造一个整数类型的对象，将标识符 `a` 与这个对象联系起来。这样，我们就可以使用 `a` 来表示一个整数类型的对象。

在声明的同时，我们也可以对对象进行初始化。例如：

```cpp
int b = 42;
```

这个声明的作用是创造一个整数类型的对象，将标识符 `b` 与这个对象联系起来，并且将 `b` 初始化为整数值 `42`。

## 初识类型

为了方便这一章的理解，以及避免引入过多的概念造成理解困难，这里介绍几种基本的类型。

* `int` 是整数类型，此类型的对象可以存储整数值。例如：`42`、`-42` 这样的字面量都是整数值（注意没有后缀），可以用这样的字面量来初始化整数类型的对象。
  * C++ 规定 `int` 类型的对象至少占用2个字节。在常见的机器上，`int` 类型的对象占用4个字节。
* `bool` 是布尔类型，此类型对象可以存储逻辑值。例如：`true`、`false` 这样的字面量都是布尔值，可以用这样的字面量来初始化布尔类型的对象。
  * C++ 没有规定 `bool` 具体占用多少字节。在常见的机器上，`bool` 类型的对象占用1个字节。 
* `char` 是字符类型，此类型对象可以存储字符。例如：`'a'`、`'b'` 这样的字面量都是字符值，可以用这样的字面量来初始化字符类型的对象。
  * C++ 规定 `char` 类型的对象占用1个字节。

::: info
“整数类型”这一说法有时候也会指代所有具有整数性质的类型，这里提到的 `int` 、 `bool` 和 `char` 都属于具有整数性质的类型。在本节中，为了方便表述，使用“整数类型”这一说法指代 `int` 类型。而在后面的章节中，则倾向直接使用“ `int` 类型”这一说法。
:::

### 初识转换

当需要的类型和提供的类型不一致时，C++ 会尝试进行一些简单的转换。简单转换不是术语，只是 C++ 的转换规则中的一部分，为了描述需要，这里专门提出来一部分。

例如，当我们需要一个整数类型的对象，但是提供的是一个字符类型的对象时，C++ 会尝试将字符类型转换为整数类型。

```cpp
int a = 'a';
```

这个声明的作用是将标识符 `a` 与整数类型联系起来，并且将 `a` 初始化为字符 `'a'` 以 ASCII 编码对应的整数值（即 `97`）。

| 目标类型 | 提供类型 | 提供的值   | 得到的值 |
| -------- | -------- | ---------- | -------- |
| `int`    | `bool`   | `true`     | `1`      |
| `int`    | `bool`   | `false`    | `0`      |
| `bool`   | `int`    | `0`        | `false`  |
| `bool`   | `int`    | 任意非零值 | `true`   |
| `bool`   | `char`   | `\0`       | `false`  |
| `bool`   | `char`   | 非`\0`值   | `true`   |
| `char`   | `bool`   | `true`     | `'\1'`   |
| `char`   | `bool`   | `false`    | `'\0'`   |


:::info int 与 char 的转换
`int` 与 `char` 显然有着不同的大小，更小的 `char` 的值无法与 `int` 的值产生对应，因此需要一定的规则来进行转换。

假设 `int` 的大小是2字节，1字节的比特数是8，那么 `int` 的值范围是`[-2^15, 2^15-1]`，也即`[-32768, 32767]`。此外，再假设 `char` 是有符号的，那么 `char` 的值范围是`[-2^7, 2^7-1]`，也即`[-128, 127]`。

C++ 规定，`int`使用补码表示，因此，`int`的`-1` 表示为 `0b1111111111111111`。

当从 `char` 转换到 `int` 时，`char` 的值会被扩展到 `int` 的大小，此时会发生符号扩展。例如，`char` 的值`-1`，其比特为`0b11111111`。会被扩展为`int` 的值`-1`（`0b1111111111111111`），而不是`255`(`0b0000000011111111`)。

当从 `int` 转换到 `char` 时，`int` 的值会被截断到 `char` 的大小，此时会按照字节宽度取余。例如，`int` 的值`193`，其比特为`0b0000000110000001`。会被截断为`char` 的值 `-63`（`0b10000001`）。


这里为了方便表述，假设了 `int` 为2字节，否则在描述比特的时候就会写出过多的0和1。对于常见的4字节 `int` 的情况，这里的规则是通用的，只是数值范围会有所不同。

此外，在特定实现中，`char` 可能是无符号的，这会导致 `0b0000000110000001` 被截断为 `193` ，而不是 `-63`，但比特位上的结果是一样的 `0b10000001`。
:::

## 快速练习

<Choices 
    :questions="[
        {
            text: '下面的声明创建了什么对象？',
            code: 'int example = \'a\';',
            shuffleOptions: false,
            options: ['int 类型的对象', 'char 类型的对象', 'bool 类型的对象', '没有创建对象'],
            answers: ['int 类型的对象']
        },
        {
            text: '下面的声明创建了什么对象？',
            code: 'int nope;',
            shuffleOptions: false,
            options: ['int 类型的对象', 'char 类型的对象', 'bool 类型的对象', '没有创建对象'],
            answers: ['int 类型的对象']
        },
        {
            text: '下面的声明创建了什么对象？',
            code: 'char test = false;',
            shuffleOptions: false,
            options: ['int 类型的对象', 'char 类型的对象', 'bool 类型的对象', '没有创建对象'],
            answers: ['char 类型的对象']
        },
        {
            text: 'a的值被初始化为什么？',
            code: 'int a = true;',
            shuffleOptions: false,
            options: ['1', 'true', '不确定值', '无法初始化'],
            answers: ['1']
        },
        {
            text: 'a的值被初始化为什么？',
            code: 'int a = \'\\54\';',
            shuffleOptions: false,
            options: ['54', '44', '1', '不确定值', '无法初始化'],
            answers: ['44']
        },
        {
            text: 'a的值被初始化为什么？',
            code: 'char a = false;',
            shuffleOptions: false,
            options: ['\'0\'', '\'\\0\'', '不确定值', '没有初始化'],
            answers: ['\'\\0\'']
        }
    ]"/>